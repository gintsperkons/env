#!/bin/bash

# Define parent -> children mapping
declare -A MENU
MENU["Power"]="Reboot Shutdown"
MENU["Settings"]="Wi-Fi Display"
MENU["Install"]="zsh vim tmux"

# Parent menu order
PARENT_ORDER=("Power" "Settings" "Install")

# Flatten all children into a separate array
CHILD_ITEMS=()
for PARENT in "${PARENT_ORDER[@]}"; do
    for CHILD in ${MENU[$PARENT]}; do
        CHILD_ITEMS+=("$PARENT / $CHILD")
    done
done

# Build the full menu: parents + children
FULL_MENU=("${PARENT_ORDER[@]}" "${CHILD_ITEMS[@]}")

# First prompt: search or pick directly
SEARCH=$(printf '%s\n' "${FULL_MENU[@]}" | rofi -dmenu -i -p "Search or pick:")

SELECTED=$SEARCH

# If user picked a parent, show its children
if [[ " ${PARENT_ORDER[*]} " =~ " ${SEARCH} " ]]; then
    CHILDREN=${MENU[$SEARCH]}
    CHOICE=$(printf '%s\n' $CHILDREN | rofi -dmenu -i -p "$SEARCH â†’")
    SELECTED="$SEARCH / $CHOICE"
    echo "Selected: $SELECTED"

if SELECTED == "Power / Shutdown"; then
    systemctl poweroff
elif SELECTED == "Power / Reboot"; then
    systemctl reboot
elif SELECTED == "Settings / Wi-Fi"; then
    gnome-control-center wifi
elif SELECTED == "Settings / Display"; then
    gnome-control-center display
elif SELECTED == "Install / zsh"; then
    bash ~/env/install/packages/zsh.sh install
elif SELECTED == "Install / vim"; then
    bash ~/env/install/packages/vim.sh install
elif SELECTED == "Install / tmux"; then
    bash ~/env/install/packages/tmux.sh install
fi

else
    echo "Selected: $SELECTED"
fi