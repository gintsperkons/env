#!/bin/bash

# Define parent -> children mapping
declare -A MENU
MENU["Power"]="Reboot Shutdown"
MENU["Settings"]="Wi-Fi Display"
MENU["Install"]="zsh vim tmux"

# Parent menu order
PARENT_ORDER=("Power" "Settings" "Install")

# Flatten all children into a separate array
CHILD_ITEMS=()
for PARENT in "${PARENT_ORDER[@]}"; do
    for CHILD in ${MENU[$PARENT]}; do
        CHILD_ITEMS+=("$PARENT / $CHILD")
    done
done

# Build the full menu: parents + children
FULL_MENU=("${PARENT_ORDER[@]}" "${CHILD_ITEMS[@]}")

# First prompt: search or pick directly
SEARCH=$(printf '%s\n' "${FULL_MENU[@]}" | rofi -dmenu -i -p "Search or pick:")

# If user picked a parent, show its children
if [[ " ${PARENT_ORDER[*]} " =~ " ${SEARCH} " ]]; then
    CHILDREN=${MENU[$SEARCH]}
    CHOICE=$(printf '%s\n' $CHILDREN | rofi -dmenu -i -p "$SEARCH â†’")
    echo "Selected: $SEARCH / $CHOICE"

# If user picked a child directly
elif [[ " ${CHILD_ITEMS[*]} " =~ " ${SEARCH} " ]]; then
    echo "Selected: $SEARCH"

# If nothing was picked
else
    echo "No selection."
fi
